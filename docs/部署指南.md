# DailyApp éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [ç¯å¢ƒè¦æ±‚](ç¯å¢ƒè¦æ±‚)
2. [åç«¯éƒ¨ç½²](åç«¯éƒ¨ç½²)
3. [å‰ç«¯é…ç½®](å‰ç«¯é…ç½®)
4. [æ•°æ®åº“é…ç½®](æ•°æ®åº“é…ç½®)
5. [Nginx é…ç½®](nginxé…ç½®)
6. [SSL é…ç½®](sslé…ç½®)
7. [ç›‘æ§å’Œæ—¥å¿—](ç›‘æ§å’Œæ—¥å¿—)

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### æœåŠ¡å™¨ç¯å¢ƒ

- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04+ / CentOS 8+ / RHEL 8+
- **Java**: OpenJDK 17 æˆ–æ›´é«˜ç‰ˆæœ¬
- **å†…å­˜**: æœ€ä½ 2GBï¼Œæ¨è 4GB+
- **å­˜å‚¨**: æœ€ä½ 10GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: å…¬ç½‘ IPï¼Œå¼€æ”¾ç«¯å£ 80, 443, 8080

### åŸŸåå’Œ DNS

- **åŸŸå**: kekedaka.xin
- **DNS è§£æ**: A è®°å½•æŒ‡å‘æœåŠ¡å™¨ IP 8.148.20.194

## ğŸš€ åç«¯éƒ¨ç½²

### 1. æœåŠ¡å™¨å‡†å¤‡

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…Java 17
sudo apt install openjdk-17-jdk -y

# éªŒè¯Javaå®‰è£…
java -version

# åˆ›å»ºåº”ç”¨ç”¨æˆ·
sudo useradd -r -s /bin/bash -d /opt/dailyapp dailyapp
sudo mkdir -p /opt/dailyapp
sudo chown dailyapp:dailyapp /opt/dailyapp

# åˆ›å»ºæ—¥å¿—ç›®å½•
sudo mkdir -p /var/log/dailyapp
sudo chown dailyapp:dailyapp /var/log/dailyapp
```

### 2. æ•°æ®åº“é…ç½®

```bash
# å®‰è£…MySQL
sudo apt install mysql-server -y

# é…ç½®MySQL
sudo mysql_secure_installation

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
sudo mysql -u root -p
```

```sql
CREATE DATABASE dailyapp;
CREATE USER 'dailyapp'@'localhost' IDENTIFIED BY 'dailyapp123';
GRANT ALL PRIVILEGES ON dailyapp.* TO 'dailyapp'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 3. æ„å»ºåº”ç”¨

åœ¨æœ¬åœ°æ‰§è¡Œï¼š

```bash
# Windows
build-and-deploy.bat

# Linux/macOS
chmod +x build-and-deploy.sh
./build-and-deploy.sh
```

### 4. ä¸Šä¼ å’Œéƒ¨ç½²

```bash
# ä¸Šä¼ JARæ–‡ä»¶åˆ°æœåŠ¡å™¨
scp serverDemo/target/serverDemo-1.0.0.jar user@kekedaka.xin:/tmp/

# åœ¨æœåŠ¡å™¨ä¸Šç§»åŠ¨æ–‡ä»¶
sudo mv /tmp/serverDemo-1.0.0.jar /opt/dailyapp/
sudo chown dailyapp:dailyapp /opt/dailyapp/serverDemo-1.0.0.jar

# å®‰è£…systemdæœåŠ¡
sudo cp dailyapp.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable dailyapp
sudo systemctl start dailyapp

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status dailyapp
```

### 5. éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥åº”ç”¨æ˜¯å¦è¿è¡Œ
curl http://localhost:8080/api/health

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u dailyapp -f
```

## ğŸ“± å‰ç«¯é…ç½®

### 1. ç¯å¢ƒé…ç½®

å‰ç«¯å·²é…ç½®æ”¯æŒè‡ªåŠ¨ç¯å¢ƒåˆ‡æ¢ï¼š

- **å¼€å‘ç¯å¢ƒ**: `http://10.0.2.2:8080/api`
- **ç”Ÿäº§ç¯å¢ƒ**: `http://kekedaka.xin:8080/api`

### 2. æ„å»ºæ­¥éª¤

1. è¿è¡Œæ„å»ºè„šæœ¬å°†å‰ç«¯åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒæ¨¡å¼
2. åœ¨ DevEco Studio ä¸­æ‰“å¼€é¡¹ç›®
3. é€‰æ‹© **Build â†’ Build Hap(s)/APP(s)**
4. æˆ–é€‰æ‹© **Build â†’ Generate Signed Bundle/APK**
5. å®‰è£…åˆ°ç›®æ ‡è®¾å¤‡

### 3. ç­¾åé…ç½®

ç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®åº”ç”¨ç­¾åï¼š

1. åœ¨ DevEco Studio ä¸­é…ç½®ç­¾åè¯ä¹¦
2. è®¾ç½®åº”ç”¨åŒ…åå’Œç‰ˆæœ¬å·
3. é…ç½®å‘å¸ƒæ¸ é“ä¿¡æ¯

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### MySQL é…ç½®ä¼˜åŒ–

ç¼–è¾‘ `/etc/mysql/mysql.conf.d/mysqld.cnf`ï¼š

```ini
[mysqld]
# åŸºæœ¬é…ç½®
bind-address = 127.0.0.1
port = 3306

# æ€§èƒ½ä¼˜åŒ–
innodb_buffer_pool_size = 1G
innodb_log_file_size = 256M
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT

# å­—ç¬¦é›†
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# è¿æ¥é…ç½®
max_connections = 200
connect_timeout = 10
wait_timeout = 600
interactive_timeout = 600
```

é‡å¯ MySQLï¼š

```bash
sudo systemctl restart mysql
```

## ğŸŒ Nginx é…ç½®

### 1. å®‰è£… Nginx

```bash
sudo apt install nginx -y
```

### 2. é…ç½®åå‘ä»£ç†

åˆ›å»º `/etc/nginx/sites-available/dailyapp`ï¼š

```nginx
server {
    listen 80;
    server_name kekedaka.xin www.kekedaka.xin;

    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # CORSå¤„ç†
        add_header Access-Control-Allow-Origin * always;
        add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
        add_header Access-Control-Allow-Headers "Authorization, Content-Type" always;

        if ($request_method = 'OPTIONS') {
            return 204;
        }
    }

    # é™æ€æ–‡ä»¶
    location / {
        root /var/www/dailyapp;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/dailyapp_access.log;
    error_log /var/log/nginx/dailyapp_error.log;
}
```

### 3. å¯ç”¨é…ç½®

```bash
sudo ln -s /etc/nginx/sites-available/dailyapp /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

## ğŸ”’ SSL é…ç½®

### 1. å®‰è£… Certbot

```bash
sudo apt install certbot python3-certbot-nginx -y
```

### 2. è·å– SSL è¯ä¹¦

```bash
sudo certbot --nginx -d kekedaka.xin -d www.kekedaka.xin
```

### 3. è‡ªåŠ¨ç»­æœŸ

```bash
# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ï¼š0 12 * * * /usr/bin/certbot renew --quiet
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. åº”ç”¨ç›‘æ§

```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
sudo systemctl status dailyapp

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u dailyapp -f

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo journalctl -u dailyapp --since "1 hour ago" -p err
```

### 2. ç³»ç»Ÿç›‘æ§

```bash
# å®‰è£…ç›‘æ§å·¥å…·
sudo apt install htop iotop nethogs -y

# ç›‘æ§èµ„æºä½¿ç”¨
htop
sudo iotop
sudo nethogs
```

### 3. æ—¥å¿—è½®è½¬

åˆ›å»º `/etc/logrotate.d/dailyapp`ï¼š

```
/var/log/dailyapp/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 dailyapp dailyapp
    postrotate
        systemctl reload dailyapp
    endscript
}
```

## ğŸ”§ å¸¸è§é—®é¢˜

### 1. ç«¯å£å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tulpn | grep :8080

# æ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 <PID>
```

### 2. æƒé™é—®é¢˜

```bash
# ä¿®å¤æ–‡ä»¶æƒé™
sudo chown -R dailyapp:dailyapp /opt/dailyapp
sudo chmod +x /opt/dailyapp/serverDemo-1.0.0.jar
```

### 3. å†…å­˜ä¸è¶³

```bash
# å¢åŠ swapç©ºé—´
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

### 4. é˜²ç«å¢™é…ç½®

```bash
# Ubuntu/Debian
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 8080

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --reload
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. æœåŠ¡å™¨ç³»ç»Ÿæ—¶é—´æ˜¯å¦æ­£ç¡®
2. DNS è§£ææ˜¯å¦ç”Ÿæ•ˆ
3. é˜²ç«å¢™å’Œå®‰å…¨ç»„é…ç½®
4. SSL è¯ä¹¦æ˜¯å¦æœ‰æ•ˆ
5. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸

---

**éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„ DailyApp å°†åœ¨ä»¥ä¸‹åœ°å€å¯ç”¨ï¼š**

- HTTP: http://kekedaka.xin
- HTTPS: https://kekedaka.xin
- API: https://kekedaka.xin/api

## è”ç³»æ”¯æŒ

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. æœåŠ¡å™¨æ—¥å¿—: `/opt/dailyapp/app.log`
2. ç³»ç»Ÿæ—¥å¿—: `journalctl -u dailyapp`
3. ç½‘ç»œè¿æ¥: `telnet 8.148.20.194 8080`
4. è¿è¡Œæµ‹è¯•è„šæœ¬: `./test_server_api.ps1`

---

**éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„ Daily App å°†åŒæ—¶æ”¯æŒæœ¬åœ°å¼€å‘å’ŒæœåŠ¡å™¨ç”Ÿäº§ç¯å¢ƒï¼**
