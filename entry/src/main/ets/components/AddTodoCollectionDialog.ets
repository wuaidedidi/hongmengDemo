import { ThemeService, ThemeConfig, DEFAULT_THEME_CONFIG } from '../services/ThemeService';

interface TodoCollectionData {
  title: string;
  description?: string;
}

@CustomDialog
export struct AddTodoCollectionDialog {
  @State title: string = '';
  @State description: string = '';
  @Prop currentTheme: ThemeConfig; // æ”¹ä¸ºPropï¼Œç”±çˆ¶ç»„ä»¶ä¼ é€’
  
  onConfirm: (data: TodoCollectionData) => void = () => {};
  controller: CustomDialogController;

  aboutToAppear() {
    console.info('AddTodoCollectionDialogæ¥æ”¶åˆ°ä¸»é¢˜:', this.currentTheme.name);
    console.info('ä¸»é¢˜é¢œè‰²:', {
      backgroundColor: this.currentTheme.backgroundColor,
      accentPrimary: this.currentTheme.glassmorphism.accentPrimary,
      surfaceLight: this.currentTheme.glassmorphism.surfaceLight
    });
  }

  build() {
    Column({ space: 20 }) {
      // æ ‡é¢˜åŒºåŸŸ
      Column({ space: 8 }) {
        Text('ğŸ“')
          .fontSize(32)
        Text('æ·»åŠ å¾…åŠåˆé›†')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor(this.currentTheme.textColor)
      }
      .alignItems(HorizontalAlign.Center)

      Column({ space: 16 }) {
        // æ ‡é¢˜è¾“å…¥
        Column({ space: 8 }) {
          Text('æ ‡é¢˜ *')
            .fontSize(14)
            .fontColor(this.currentTheme.glassmorphism.accentPrimary)
            .fontWeight(FontWeight.Medium)
            .alignSelf(ItemAlign.Start)
          
          TextInput({ placeholder: 'è¯·è¾“å…¥åˆé›†æ ‡é¢˜' })
            .borderRadius(16)
            .backgroundColor(this.currentTheme.glassmorphism.surfaceLight + 'D0')
            .border({ 
              width: 0.5, 
              color: this.currentTheme.glassmorphism.accentSecondary + '50' 
            })
            .placeholderColor(this.currentTheme.textColor + '80')
            .fontColor(this.currentTheme.textColor)
            .padding(16)
            .backdropBlur(8)
            .shadow({
              radius: 6,
              color: this.currentTheme.glassmorphism.accentPrimary + '20',
              offsetX: 0,
              offsetY: 2
            })
            .onChange((value: string) => {
              this.title = value;
            })
        }
        .alignItems(HorizontalAlign.Start)

        // æè¿°è¾“å…¥
        Column({ space: 8 }) {
          Text('æè¿°')
            .fontSize(14)
            .fontColor(this.currentTheme.glassmorphism.accentSecondary)
            .fontWeight(FontWeight.Medium)
            .alignSelf(ItemAlign.Start)
          
          TextArea({ placeholder: 'è¯·è¾“å…¥åˆé›†æè¿°ï¼ˆå¯é€‰ï¼‰' })
            .height(80)
            .borderRadius(16)
            .backgroundColor(this.currentTheme.glassmorphism.surfaceLight + 'D0')
            .border({ 
              width: 0.5, 
              color: this.currentTheme.glassmorphism.accentSecondary + '50' 
            })
            .placeholderColor(this.currentTheme.textColor + '80')
            .fontColor(this.currentTheme.textColor)
            .padding(16)
            .backdropBlur(8)
            .shadow({
              radius: 6,
              color: this.currentTheme.glassmorphism.accentPrimary + '20',
              offsetX: 0,
              offsetY: 2
            })
            .onChange((value: string) => {
              this.description = value;
            })
        }
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')

      // æŒ‰é’®åŒºåŸŸ - è‹¹æœé£æ ¼æ¸å˜è®¾è®¡
      Row({ space:12 }) {
        Button('å–æ¶ˆ')
          .fontSize(16)
          .fontColor(this.currentTheme.glassmorphism.accentSecondary)
          .backgroundColor(this.currentTheme.glassmorphism.surfaceLight + 'B0')
          .border({ 
            width: 0.5, 
            color: this.currentTheme.glassmorphism.accentSecondary + '60' 
          })
          .borderRadius(16)
          .layoutWeight(1)
          .height(48)
          .backdropBlur(8)
          .shadow({
            radius: 8,
            color: this.currentTheme.glassmorphism.accentSecondary + '20',
            offsetX: 0,
            offsetY: 2
          })
          .onClick(() => {
            this.controller.close();
          })

        Button('ç¡®è®¤')
          .fontSize(16)
          .fontColor('#FFFFFF')
          .linearGradient({
            angle: 135,
            colors: [
              [this.currentTheme.glassmorphism.accentPrimary, 0.0],
              [this.currentTheme.glassmorphism.accentSecondary, 1.0]
            ]
          })
          .borderRadius(16)
          .border({ 
            width: 0.5, 
            color: this.currentTheme.glassmorphism.accentPrimary + '60' 
          })
          .layoutWeight(1)
          .height(48)
          .backdropBlur(8)
          .shadow({
            radius: 12,
            color: this.currentTheme.glassmorphism.accentPrimary + '50',
            offsetX: 0,
            offsetY: 3
          })
          .blur(0.2) // å“‘å…‰æ•ˆæœ
          .enabled(this.title.trim().length > 0)
          .opacity(this.title.trim().length > 0 ? 1.0 : 0.5)
          .onClick(() => {
            if (this.title.trim().length > 0) {
              this.onConfirm({
                title: this.title.trim(),
                description: this.description.trim()
              });
              this.controller.close();
            }
          })
      }
      .width('100%')
    }
    .width(320)
    .padding(24)
    .backgroundColor(Color.Transparent) // å®Œå…¨é€æ˜çš„å¤–å±‚èƒŒæ™¯
    .borderRadius(24)
    .backdropBlur(20)
    .linearGradient({
      angle: 135,
      colors: [
        [this.currentTheme.backgroundColor + 'E8', 0.0],
        [this.currentTheme.glassmorphism.surfaceLight + 'F0', 1.0]
      ]
    })
    .shadow({
      radius: 30,
      color: this.currentTheme.glassmorphism.accentPrimary + '25',
      offsetX: 0,
      offsetY: 12
    })
  }
} 