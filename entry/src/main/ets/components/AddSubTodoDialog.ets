import { ThemeService, ThemeConfig, DEFAULT_THEME_CONFIG } from '../services/ThemeService';

@CustomDialog
export struct AddSubTodoDialog {
  @State title: string = '';
  @State description: string = '';
  @State durationMinutes: number = 25;
  @Prop currentTheme: ThemeConfig; // æ”¹ä¸ºPropï¼Œç”±çˆ¶ç»„ä»¶ä¼ é€’
  
  onConfirm: (title: string, description: string, duration: number) => void = () => {};
  controller: CustomDialogController;

  aboutToAppear() {
    console.info('AddSubTodoDialogæ¥æ”¶åˆ°ä¸»é¢˜:', this.currentTheme.name);
    console.info('ä¸»é¢˜é¢œè‰²:', {
      backgroundColor: this.currentTheme.backgroundColor,
      accentPrimary: this.currentTheme.glassmorphism.accentPrimary,
      surfaceLight: this.currentTheme.glassmorphism.surfaceLight
    });
  }

  build() {
    Column({ space: 20 }) {
      // æ ‡é¢˜åŒºåŸŸ
      Column({ space: 8 }) {
        Text('ğŸ“‹')
          .fontSize(32)
        Text('æ·»åŠ å­å¾…åŠ')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
          .fontColor(this.currentTheme.textColor)
      }
      .alignItems(HorizontalAlign.Center)

      Column({ space: 16 }) {
        // æ ‡é¢˜è¾“å…¥
        Column({ space: 8 }) {
          Text('æ ‡é¢˜ *')
            .fontSize(14)
            .fontColor(this.currentTheme.glassmorphism.accentPrimary)
            .fontWeight(FontWeight.Medium)
            .alignSelf(ItemAlign.Start)
          
          TextInput({ placeholder: 'è¯·è¾“å…¥å­å¾…åŠæ ‡é¢˜' })
            .borderRadius(16)
            .backgroundColor(this.currentTheme.glassmorphism.surfaceLight + 'D0')
            .border({ 
              width: 0.5, 
              color: this.currentTheme.glassmorphism.accentSecondary + '50' 
            })
            .placeholderColor(this.currentTheme.textColor + '80')
            .fontColor(this.currentTheme.textColor)
            .padding(16)
            .backdropBlur(8)
            .shadow({
              radius: 6,
              color: this.currentTheme.glassmorphism.accentPrimary + '20',
              offsetX: 0,
              offsetY: 2
            })
            .onChange((value: string) => {
              this.title = value;
            })
        }
        .alignItems(HorizontalAlign.Start)

        // æè¿°è¾“å…¥
        Column({ space: 8 }) {
          Text('æè¿°')
            .fontSize(14)
            .fontColor(this.currentTheme.glassmorphism.accentSecondary)
            .fontWeight(FontWeight.Medium)
            .alignSelf(ItemAlign.Start)
          
          TextArea({ placeholder: 'è¯·è¾“å…¥å­å¾…åŠæè¿°ï¼ˆå¯é€‰ï¼‰' })
            .height(80)
            .borderRadius(16)
            .backgroundColor(this.currentTheme.glassmorphism.surfaceLight + 'D0')
            .border({ 
              width: 0.5, 
              color: this.currentTheme.glassmorphism.accentSecondary + '50' 
            })
            .placeholderColor(this.currentTheme.textColor + '80')
            .fontColor(this.currentTheme.textColor)
            .padding(16)
            .backdropBlur(8)
            .shadow({
              radius: 6,
              color: this.currentTheme.glassmorphism.accentPrimary + '20',
              offsetX: 0,
              offsetY: 2
            })
            .onChange((value: string) => {
              this.description = value;
            })
        }
        .alignItems(HorizontalAlign.Start)

        // ä¸“æ³¨æ—¶é•¿è®¾ç½®
        Column({ space: 8 }) {
          Text('ä¸“æ³¨æ—¶é•¿')
            .fontSize(14)
            .fontColor(this.currentTheme.glassmorphism.accentTertiary)
            .fontWeight(FontWeight.Medium)
            .alignSelf(ItemAlign.Start)
          
          Row({ space: 12 }) {
            TextInput({ text: this.durationMinutes.toString() })
              .width(100)
              .borderRadius(16)
              .backgroundColor(this.currentTheme.glassmorphism.surfaceLight + 'D0')
              .border({ 
                width: 0.5, 
                color: this.currentTheme.glassmorphism.accentSecondary + '50' 
              })
              .fontColor(this.currentTheme.textColor)
              .textAlign(TextAlign.Center)
              .type(InputType.Number)
              .padding(16)
              .backdropBlur(8)
              .shadow({
                radius: 6,
                color: this.currentTheme.glassmorphism.accentPrimary + '20',
                offsetX: 0,
                offsetY: 2
              })
              .onChange((value: string) => {
                const num = parseInt(value);
                if (!isNaN(num) && num > 0) {
                  this.durationMinutes = num;
                }
              })
            
            Text('åˆ†é’Ÿ')
              .fontSize(14)
              .fontColor(this.currentTheme.glassmorphism.accentTertiary)
              .fontWeight(FontWeight.Medium)
          }
          .alignItems(VerticalAlign.Center)
        }
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')

      // æŒ‰é’®åŒºåŸŸ - è‹¹æœé£æ ¼æ¸å˜è®¾è®¡
      Row({ space: 12 }) {
        Button('å–æ¶ˆ')
          .fontSize(16)
          .fontColor(this.currentTheme.glassmorphism.accentSecondary)
          .backgroundColor(this.currentTheme.glassmorphism.surfaceLight + 'B0')
          .border({ 
            width: 0.5, 
            color: this.currentTheme.glassmorphism.accentSecondary + '60' 
          })
          .borderRadius(16)
          .layoutWeight(1)
          .height(48)
          .backdropBlur(8)
          .shadow({
            radius: 8,
            color: this.currentTheme.glassmorphism.accentSecondary + '20',
            offsetX: 0,
            offsetY: 2
          })
          .onClick(() => {
            this.controller.close();
          })

        Button('ç¡®è®¤')
          .fontSize(16)
          .fontColor('#FFFFFF')
          .linearGradient({
            angle: 135,
            colors: [
              [this.currentTheme.glassmorphism.accentPrimary, 0.0],
              [this.currentTheme.glassmorphism.accentSecondary, 1.0]
            ]
          })
          .borderRadius(16)
          .border({ 
            width: 0.5, 
            color: this.currentTheme.glassmorphism.accentPrimary + '60' 
          })
          .layoutWeight(1)
          .height(48)
          .backdropBlur(8)
          .shadow({
            radius: 12,
            color: this.currentTheme.glassmorphism.accentPrimary + '50',
            offsetX: 0,
            offsetY: 3
          })
          .blur(0.2) // å“‘å…‰æ•ˆæœ
          .enabled(this.title.trim().length > 0)
          .opacity(this.title.trim().length > 0 ? 1.0 : 0.5)
          .onClick(() => {
            if (this.title.trim().length > 0) {
              this.onConfirm(this.title.trim(), this.description.trim(), this.durationMinutes);
              this.controller.close();
            }
          })
      }
      .width('100%')
    }
    .width(340)
    .padding(24)
    .backgroundColor(Color.Transparent) // å®Œå…¨é€æ˜çš„å¤–å±‚èƒŒæ™¯
    .borderRadius(24)
    .backdropBlur(20)
    .linearGradient({
      angle: 135,
      colors: [
        [this.currentTheme.backgroundColor + 'E8', 0.0],
        [this.currentTheme.glassmorphism.surfaceLight + 'F0', 1.0]
      ]
    })
    .shadow({
      radius: 30,
      color: this.currentTheme.glassmorphism.accentPrimary + '25',
      offsetX: 0,
      offsetY: 12
    })
  }
} 