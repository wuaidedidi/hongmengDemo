import router from '@ohos.router';
import promptAction from '@ohos.promptAction';

interface TabItem {
  icon: string;
  text: string;
  path: string;
}

@Component
export struct TabBar {
  @Prop currentIndex: number = 0;
  @Prop isLocked?: boolean = false;  // æ·»åŠ é”æœºçŠ¶æ€å±žæ€§

  private tabs: TabItem[] = [
    { icon: 'ðŸ“…', text: 'å¾…åŠž', path: 'pages/Index' },
    { icon: 'ðŸ“', text: 'å¾…åŠžäº‹é¡¹', path: 'pages/TodoDetail' },
    { icon: 'ðŸ”’', text: 'é”æœº', path: 'pages/LockPage' },
    { icon: 'ðŸ“Š', text: 'ç»Ÿè®¡æ•°æ®', path: 'pages/StatisticsPage' },
    { icon: 'ðŸ‘¤', text: 'æˆ‘çš„', path: 'pages/Profile' }
  ];

  @Builder
  TabBuilder(index: number, icon: string, text: string) {
    Column() {
      Text(icon)
        .fontSize(24)
        .fontColor(this.currentIndex === index ? '#8A2BE2' : '#666666')
      Text(text)
        .fontSize(12)
        .margin({ top: 4 })
        .fontColor(this.currentIndex === index ? '#8A2BE2' : '#666666')
    }
    .width('20%')
    .height(56)
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
    .onClick(() => {
      if (this.currentIndex !== index) {
        // æ£€æŸ¥æ˜¯å¦åœ¨é”æœºçŠ¶æ€
        if (this.isLocked && this.currentIndex === 2) {
          promptAction.showToast({ 
            message: 'è¯·å…ˆè§£é™¤é”æœºçŠ¶æ€å†åˆ‡æ¢é¡µé¢',
            duration: 2000
          });
          return;
        }
        console.info(`æ­£åœ¨è·³è½¬åˆ°: ${this.tabs[index].path}`);
        router.pushUrl({
          url: this.tabs[index].path,
          params: {}
        }).then(() => {
          console.info(`æˆåŠŸè·³è½¬åˆ°: ${this.tabs[index].path}`);
        }).catch((err: Error) => {
          console.error(`å¯¼èˆªå¤±è´¥: ${err.message}`);
          promptAction.showToast({ 
            message: `é¡µé¢è·³è½¬å¤±è´¥: ${err.message}`,
            duration: 2000
          });
        });
      }
    })
  }

  build() {
    Row() {
      ForEach(this.tabs, (item: TabItem, index: number) => {
        this.TabBuilder(index, item.icon, item.text)
      })
    }
    .width('100%')
    .height(56)
    .backgroundColor(Color.White)
    .justifyContent(FlexAlign.SpaceEvenly)
    .border({ width: { top: 0.5 }, color: '#E0E0E0' })
    .shadow({ radius: 4, color: 'rgba(0,0,0,0.1)', offsetY: -2 })
    .zIndex(1)
  }
} 