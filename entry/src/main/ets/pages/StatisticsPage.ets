import router from '@ohos.router';

@Entry
@Component
export default struct StatisticsPage {
  @State currentDate: string = '2025-05-12';
  @State currentMonth: string = '2025å¹´05æœˆ';
  @State currentTabIndex: number = 0; // 0:æ—¥, 1:å‘¨, 2:æœˆ, 3:è‡ªå®šä¹‰
  @State showShareMenu: boolean = false;
  
  build() {
    Stack() {
      // èƒŒæ™¯
      Column()
        .width('100%')
        .height('100%')
        .backgroundColor('#F8F8F8')
      
      Column() {
        // é¡¶éƒ¨æ  - è“è‰²æ¸å˜èƒŒæ™¯
        Row() {
          Text('ç»Ÿè®¡æ•°æ®')
            .fontSize(22)
            .fontWeight(FontWeight.Bold)
            .fontColor('#FFFFFF')
          
          Blank()
          
          Row({ space: 16 }) {
            Text('â±ï¸').fontSize(24).fontColor('#FFFFFF')
            Text('ğŸ†').fontSize(24).fontColor('#FFFFFF')
            Text('â‰¡').fontSize(24).fontColor('#FFFFFF')
          }
        }
        .width('100%')
        .height(60)
        .padding({ left: 16, right: 16 })
        .backgroundColor('#22B6F7')
        
        // ä¸»ä½“å†…å®¹ - æ»šåŠ¨åŒºåŸŸ
        Scroll() {
          Column({ space: 12 }) {
            // ç´¯è®¡ä¸“æ³¨å¡ç‰‡
            Column() {
              Row() {
                Text('ç´¯è®¡ä¸“æ³¨ ')
                  .fontSize(18)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#22B6F7')
                
                Text('ğŸ”')
                  .fontSize(20)
              }
              .width('100%')
              .padding({ left: 16, right: 16, top: 16, bottom: 8 })
              
              // ç»Ÿè®¡æ•°æ®
              Row() {
                // æ¬¡æ•°
                Column() {
                  Text('æ¬¡æ•°')
                    .fontSize(16)
                    .fontColor('#666666')
                  
                  Text('685')
                    .fontSize(40)
                    .fontWeight(FontWeight.Bold)
                    .fontColor('#22B6F7')
                }
                .layoutWeight(1)
                .alignItems(HorizontalAlign.Center)
                
                // æ—¶é•¿
                Column() {
                  Text('æ—¶é•¿')
                    .fontSize(16)
                    .fontColor('#666666')
                  
                  Row({ space: 4 }) {
                    Text('527')
                      .fontSize(40)
                      .fontWeight(FontWeight.Bold)
                      .fontColor('#22B6F7')
                    
                    Column() {
                      Text('å°æ—¶')
                        .fontSize(14)
                        .fontColor('#666666')
                      
                      Text('42')
                        .fontSize(24)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#22B6F7')
                      
                      Text('åˆ†é’Ÿ')
                        .fontSize(14)
                        .fontColor('#666666')
                    }
                    .alignItems(HorizontalAlign.Center)
                    .justifyContent(FlexAlign.Center)
                  }
                }
                .layoutWeight(1)
                .alignItems(HorizontalAlign.Center)
                
                // æ—¥å‡æ—¶é•¿
                Column() {
                  Text('æ—¥å‡æ—¶é•¿')
                    .fontSize(16)
                    .fontColor('#666666')
                  
                  Row({ space: 4 }) {
                    Text('5')
                      .fontSize(40)
                      .fontWeight(FontWeight.Bold)
                      .fontColor('#22B6F7')
                    
                    Column() {
                      Text('å°æ—¶')
                        .fontSize(14)
                        .fontColor('#666666')
                      
                      Text('19')
                        .fontSize(24)
                        .fontWeight(FontWeight.Bold)
                        .fontColor('#22B6F7')
                      
                      Text('åˆ†é’Ÿ')
                        .fontSize(14)
                        .fontColor('#666666')
                    }
                    .alignItems(HorizontalAlign.Center)
                    .justifyContent(FlexAlign.Center)
                  }
                }
                .layoutWeight(1)
                .alignItems(HorizontalAlign.Center)
              }
              .padding({ bottom: 16 })
            }
            .width('100%')
            .backgroundColor('#FFFFFF')
            .borderRadius(12)
            
            // å½“æ—¥ä¸“æ³¨å¡ç‰‡
            Column() {
              Row() {
                Text('å½“æ—¥ä¸“æ³¨ ')
                  .fontSize(18)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#22B6F7')
                
                Text(this.currentDate)
                  .fontSize(16)
                  .fontColor('#666666')
                
                Blank()
                
                Text('â—€')
                  .fontSize(20)
                  .fontColor('#22B6F7')
                  .onClick(() => {
                    // æ—¥æœŸå‰ç§»ä¸€å¤©
                    const date = new Date(this.currentDate);
                    date.setDate(date.getDate() - 1);
                    this.currentDate = this.formatDate(date);
                  })
                
                Text('â–¶')
                  .fontSize(20)
                  .fontColor('#22B6F7')
                  .margin({ left: 16 })
                  .onClick(() => {
                    // æ—¥æœŸåç§»ä¸€å¤©
                    const date = new Date(this.currentDate);
                    date.setDate(date.getDate() + 1);
                    this.currentDate = this.formatDate(date);
                  })
              }
              .width('100%')
              .padding({ left: 16, right: 16, top: 16, bottom: 8 })
              
              // ç»Ÿè®¡æ•°æ®
              Row() {
                // æ¬¡æ•°
                Column() {
                  Text('æ¬¡æ•°')
                    .fontSize(16)
                    .fontColor('#666666')
                  
                  Text('0')
                    .fontSize(40)
                    .fontWeight(FontWeight.Bold)
                    .fontColor('#22B6F7')
                }
                .layoutWeight(1)
                .alignItems(HorizontalAlign.Center)
                
                // æ—¶é•¿
                Column() {
                  Text('æ—¶é•¿')
                    .fontSize(16)
                    .fontColor('#666666')
                  
                  Row({ space: 4 }) {
                    Text('0')
                      .fontSize(40)
                      .fontWeight(FontWeight.Bold)
                      .fontColor('#22B6F7')
                    
                    Column() {
                      Text('åˆ†é’Ÿ')
                        .fontSize(14)
                        .fontColor('#666666')
                    }
                    .alignItems(HorizontalAlign.Center)
                    .justifyContent(FlexAlign.Center)
                  }
                }
                .layoutWeight(1)
                .alignItems(HorizontalAlign.Center)
              }
              .padding({ bottom: 16 })
            }
            .width('100%')
            .backgroundColor('#FFFFFF')
            .borderRadius(12)
            
            // ä¸“æ³¨æ—¶é•¿åˆ†å¸ƒå¡ç‰‡
            Column() {
              Row() {
                Text('ä¸“æ³¨æ—¶é•¿åˆ†å¸ƒ ')
                  .fontSize(18)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#22B6F7')
                
                Text(this.currentDate)
                  .fontSize(16)
                  .fontColor('#666666')
                
                Blank()
                
                Text('åˆ†äº«')
                  .fontSize(16)
                  .fontColor('#22B6F7')
                  .onClick(() => {
                    this.showShareMenu = true;
                  })
                
                Text('â—€')
                  .fontSize(20)
                  .fontColor('#22B6F7')
                  .margin({ left: 16 })
                  .onClick(() => {
                    // æ—¥æœŸå‰ç§»ä¸€å¤©
                    const date = new Date(this.currentDate);
                    date.setDate(date.getDate() - 1);
                    this.currentDate = this.formatDate(date);
                  })
                
                Text('â–¶')
                  .fontSize(20)
                  .fontColor('#22B6F7')
                  .margin({ left: 16 })
                  .onClick(() => {
                    // æ—¥æœŸåç§»ä¸€å¤©
                    const date = new Date(this.currentDate);
                    date.setDate(date.getDate() + 1);
                    this.currentDate = this.formatDate(date);
                  })
              }
              .width('100%')
              .padding({ left: 16, right: 16, top: 16, bottom: 8 })
              
              // æ—¶é—´åˆ†å¸ƒé€‰é¡¹å¡
              Tabs() {
                TabContent() {
                  Column() {
                    // ç©ºçŠ¶æ€æç¤º
                    Column() {
                      Text('æš‚æ— ä¸“æ³¨æ•°æ®ï¼Œç‚¹å‡»å¾…åŠä¸Šçš„å¼€å§‹æŒ‰é’®æ¥ä¸“æ³¨è®¡æ—¶å§')
                        .fontSize(16)
                        .fontColor('#999999')
                        .textAlign(TextAlign.Center)
                        .margin({ top: 80, bottom: 80 })
                    }
                    .width('100%')
                    .alignItems(HorizontalAlign.Center)
                    
                    // æŸ¥çœ‹ä¸“æ³¨è®°å½•æŒ‰é’®
                    Button('æŸ¥çœ‹ä¸“æ³¨è®°å½•')
                      .width('60%')
                      .height(40)
                      .fontSize(16)
                      .fontColor('#FFFFFF')
                      .backgroundColor('#22B6F7')
                      .borderRadius(20)
                      .margin({ bottom: 16 })
                  }
                }.tabBar('æ—¥')
                
                TabContent() {
                  Column() {
                    // å‘¨è§†å›¾
                    Text('å‘¨è§†å›¾æ˜¾ç¤ºåŒºåŸŸ')
                      .fontSize(16)
                      .fontColor('#999999')
                      .margin({ top: 80, bottom: 80 })
                  }
                }.tabBar('å‘¨')
                
                TabContent() {
                  Column() {
                    // æœˆè§†å›¾
                    Text('æœˆè§†å›¾æ˜¾ç¤ºåŒºåŸŸ')
                      .fontSize(16)
                      .fontColor('#999999')
                      .margin({ top: 80, bottom: 80 })
                  }
                }.tabBar('æœˆ')
                
                TabContent() {
                  Column() {
                    // è‡ªå®šä¹‰è§†å›¾
                    Text('è‡ªå®šä¹‰è§†å›¾æ˜¾ç¤ºåŒºåŸŸ')
                      .fontSize(16)
                      .fontColor('#999999')
                      .margin({ top: 80, bottom: 80 })
                  }
                }.tabBar('è‡ªå®šä¹‰')
              }
              .barMode(BarMode.Fixed)
              .barWidth('100%')
              .backgroundColor('#F5F5F5')
              .onChange((index: number) => {
                this.currentTabIndex = index;
              })
            }
            .width('100%')
            .backgroundColor('#FFFFFF')
            .borderRadius(12)
            
            // æœ¬æœˆä¸“æ³¨æ—¶æ®µåˆ†å¸ƒå¡ç‰‡
            Column() {
              Row() {
                Text('æœ¬æœˆä¸“æ³¨æ—¶æ®µåˆ†å¸ƒ ')
                  .fontSize(18)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#22B6F7')
                
                Text(this.currentMonth)
                  .fontSize(16)
                  .fontColor('#666666')
                
                Blank()
                
                Text('â—€')
                  .fontSize(20)
                  .fontColor('#22B6F7')
                  .onClick(() => {
                    // æœˆä»½å‰ç§»ä¸€æœˆ
                    const date = new Date(this.currentDate);
                    date.setMonth(date.getMonth() - 1);
                    this.currentMonth = this.formatMonth(date);
                  })
                
                Text('â–¶')
                  .fontSize(20)
                  .fontColor('#22B6F7')
                  .margin({ left: 16 })
                  .onClick(() => {
                    // æœˆä»½åç§»ä¸€æœˆ
                    const date = new Date(this.currentDate);
                    date.setMonth(date.getMonth() + 1);
                    this.currentMonth = this.formatMonth(date);
                  })
              }
              .width('100%')
              .padding({ left: 16, right: 16, top: 16, bottom: 8 })
              
              // æœˆåº¦ä¸“æ³¨æ—¶æ®µåˆ†å¸ƒå†…å®¹
              Column() {
                // ç©ºçŠ¶æ€æç¤º
                Text('æš‚æ— ä¸“æ³¨æ•°æ®ï¼Œç‚¹å‡»å¾…åŠä¸Šçš„å¼€å§‹æŒ‰é’®æ¥ä¸“æ³¨è®¡æ—¶å§')
                  .fontSize(16)
                  .fontColor('#999999')
                  .textAlign(TextAlign.Center)
                  .margin({ top: 80, bottom: 80 })
              }
              .width('100%')
              .alignItems(HorizontalAlign.Center)
              .padding({ bottom: 16 })
            }
            .width('100%')
            .backgroundColor('#FFFFFF')
            .borderRadius(12)
            .margin({ bottom: 16 })
          }
          .width('100%')
          .padding(12)
        }
        .width('100%')
        .layoutWeight(1)
        
        // åº•éƒ¨å¯¼èˆªæ 
        Row() {
          Column() {
            Text('ğŸ“…').fontSize(24)
            Text('å¾…åŠ').fontSize(12).margin({ top: 4 })
          }.layoutWeight(1).justifyContent(FlexAlign.Center)
          .onClick(() => {
            router.push({ url: 'pages/Index' });
          })
          
          Column() {
            Text('ğŸ“').fontSize(24)
            Text('å¾…åŠé›†').fontSize(12).margin({ top: 4 })
          }.layoutWeight(1).justifyContent(FlexAlign.Center)
          .onClick(() => {
            router.push({ url: 'pages/Second' });
          })
          
          Column() {
            Text('ğŸ”’').fontSize(24)
            Text('é”æœº').fontSize(12).margin({ top: 4 })
          }.layoutWeight(1).justifyContent(FlexAlign.Center)
          .onClick(() => {
            router.push({ url: 'pages/LockPage' });
          })
          
          Column() {
            Text('ğŸ“Š').fontSize(24)
            Text('ç»Ÿè®¡æ•°æ®').fontSize(12).margin({ top: 4 }).fontColor('#22B6F7')
          }.layoutWeight(1).justifyContent(FlexAlign.Center)
          
          Column() {
            Text('ğŸ‘¤').fontSize(24)
            Text('æˆ‘çš„').fontSize(12).margin({ top: 4 })
          }.layoutWeight(1).justifyContent(FlexAlign.Center)
          .onClick(() => {
            router.push({ url: 'pages/ProfilePage' });
          })
        }
        .height(60)
        .width('100%')
        .backgroundColor('#FFFFFF')
        .border({ width: { top: 1 }, color: { top: '#E0E0E0' } })
      }
      .width('100%')
      .height('100%')
      
      // åˆ†äº«èœå• - æ¡ä»¶æ¸²æŸ“
      if (this.showShareMenu) {
        Column() {
          Column() {
            Text('åˆ†äº«åˆ°')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .margin({ top: 16, bottom: 20 })
            
            Row({ space: 24 }) {
              Column() {
                Text('ğŸ’¬').fontSize(36)
                Text('å¾®ä¿¡').fontSize(14).margin({ top: 8 })
              }.alignItems(HorizontalAlign.Center)
              
              Column() {
                Text('ğŸ‘¥').fontSize(36)
                Text('æœ‹å‹åœˆ').fontSize(14).margin({ top: 8 })
              }.alignItems(HorizontalAlign.Center)
              
              Column() {
                Text('ğŸ”—').fontSize(36)
                Text('å¤åˆ¶é“¾æ¥').fontSize(14).margin({ top: 8 })
              }.alignItems(HorizontalAlign.Center)
            }
            .padding({ bottom: 20 })
            
            Button('å–æ¶ˆ')
              .width('80%')
              .height(44)
              .fontSize(16)
              .fontColor('#333333')
              .backgroundColor('#F5F5F5')
              .borderRadius(22)
              .margin({ bottom: 16 })
              .onClick(() => {
                this.showShareMenu = false;
              })
          }
          .width('90%')
          .backgroundColor('#FFFFFF')
          .borderRadius(16)
          .alignItems(HorizontalAlign.Center)
        }
        .width('100%')
        .height('100%')
        .backgroundColor('rgba(0, 0, 0, 0.5)')
        .justifyContent(FlexAlign.End)
        .onClick(() => {
          this.showShareMenu = false;
        })
      }
    }
    .width('100%')
    .height('100%')
  }
  
  // æ ¼å¼åŒ–æ—¥æœŸä¸º YYYY-MM-DD
  private formatDate(date: Date): string {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }
  
  // æ ¼å¼åŒ–æœˆä»½ä¸º YYYYå¹´MMæœˆ
  private formatMonth(date: Date): string {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    return `${year}å¹´${month}æœˆ`;
  }
} 