<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åç«¯APIæµ‹è¯•</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      .section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
        background: #007aff;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .result {
        margin: 10px 0;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 3px;
        font-family: monospace;
        white-space: pre-wrap;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      input,
      textarea {
        padding: 8px;
        margin: 5px;
        border: 1px solid #ccc;
        border-radius: 3px;
      }
      .form-group {
        margin: 10px 0;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>HarmonyOSåç«¯APIæµ‹è¯•å·¥å…·</h1>

      <div class="section" style="background: #fff3cd; border-color: #ffeaa7">
        <h2>âš¡ å¿«é€Ÿå¼€å§‹</h2>
        <p><strong>ç¬¬ä¸€æ­¥ï¼š</strong> ç¡®ä¿åç«¯æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ</p>
        <p>å¦‚æœæœåŠ¡å™¨æœªå¯åŠ¨æˆ–éœ€è¦é‡æ–°ç¼–è¯‘ï¼Œè¯·åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š</p>
        <div style="background: #2c3e50; color: #ecf0f1; padding: 10px; border-radius: 5px; font-family: monospace">
          <strong>æ–¹æ³•1: é‡æ–°ç¼–è¯‘å¹¶å¯åŠ¨ï¼ˆæ¨èï¼‰</strong><br />
          cd serverDemo<br />
          restart_server.bat<br /><br />
          <strong>æ–¹æ³•2: ç›´æ¥å¯åŠ¨ï¼ˆå¦‚æœå·²ç¼–è¯‘ï¼‰</strong><br />
          cd serverDemo<br />
          java -jar target\harmony-daily-app-0.0.1-SNAPSHOT.jar
        </div>
        <p><strong>ç¬¬äºŒæ­¥ï¼š</strong> ç‚¹å‡»ä¸‹é¢çš„"æµ‹è¯•è¿æ¥"æŒ‰é’®æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€</p>
        <p><strong>ç¬¬ä¸‰æ­¥ï¼š</strong> ä½¿ç”¨"å¤§ç™½å…”/7758258"ç™»å½•</p>
        <p><strong>ç¬¬å››æ­¥ï¼š</strong> æ·»åŠ æµ‹è¯•æ•°æ®</p>
        <ul style="margin: 10px 0; padding-left: 20px">
          <li>ğŸ“ <strong>å¾…åŠäº‹é¡¹ï¼š</strong> ç‚¹å‡»"æ·»åŠ 3ä¸ªæµ‹è¯•å¾…åŠäº‹é¡¹"æ·»åŠ åŸºç¡€ä»»åŠ¡</li>
          <li>ğŸ“š <strong>å¾…åŠåˆé›†ï¼š</strong> ç‚¹å‡»"ä¸€é”®æ·»åŠ 3ä¸ªæµ‹è¯•åˆé›†ï¼ˆå«å­ä»»åŠ¡ï¼‰"æ·»åŠ å­¦ä¹ è®¡åˆ’ã€é¡¹ç›®è®¡åˆ’ã€å¥åº·è®¡åˆ’</li>
          <li>ğŸ” <strong>éªŒè¯æ•°æ®ï¼š</strong> ä½¿ç”¨"è·å–å¾…åŠäº‹é¡¹åˆ—è¡¨"å’Œ"è·å–å¾…åŠåˆé›†åˆ—è¡¨"æŸ¥çœ‹æ·»åŠ çš„æ•°æ®</li>
        </ul>
        <p><strong>æ³¨æ„ï¼š</strong> å¦‚æœé‡åˆ°CORSé”™è¯¯ï¼Œè¯·ä½¿ç”¨æ–¹æ³•1é‡æ–°ç¼–è¯‘å¯åŠ¨æœåŠ¡å™¨</p>
      </div>

      <div class="section">
        <h2>1. æµ‹è¯•æœåŠ¡å™¨è¿æ¥</h2>
        <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
        <div id="connectionResult" class="result"></div>
      </div>

      <div class="section">
        <h2>2. ç”¨æˆ·ç™»å½•</h2>
        <div class="form-group">
          <label>ç”¨æˆ·å:</label>
          <input type="text" id="username" value="å¤§ç™½å…”" />
        </div>
        <div class="form-group">
          <label>å¯†ç :</label>
          <input type="password" id="password" value="7758258" />
        </div>
        <button onclick="login()">ç™»å½•</button>
        <div id="loginResult" class="result"></div>
      </div>

      <div class="section">
        <h2>3. è·å–å¾…åŠäº‹é¡¹</h2>
        <button onclick="getTodos()">è·å–å¾…åŠäº‹é¡¹åˆ—è¡¨</button>
        <div id="todosResult" class="result"></div>
      </div>

      <div class="section">
        <h2>4. æ‰‹åŠ¨æ·»åŠ å•ä¸ªå¾…åŠäº‹é¡¹ï¼ˆè°ƒè¯•ç”¨ï¼‰</h2>
        <div class="form-group">
          <label>æ ‡é¢˜:</label>
          <input type="text" id="todoTitle" value="æµ‹è¯•ä»»åŠ¡" />
        </div>
        <div class="form-group">
          <label>æè¿°:</label>
          <input type="text" id="todoDescription" value="è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ä»»åŠ¡" />
        </div>
        <div class="form-group">
          <label>ç±»å‹:</label>
          <input type="text" id="todoType" value="æµ‹è¯•" />
        </div>
        <div class="form-group">
          <label>æ—¶é•¿(åˆ†é’Ÿ):</label>
          <input type="number" id="todoDuration" value="30" />
        </div>
        <button onclick="addSingleTodo()">æ·»åŠ å•ä¸ªå¾…åŠäº‹é¡¹</button>
        <div id="singleTodoResult" class="result"></div>
      </div>

      <div class="section">
        <h2>5. æ·»åŠ æµ‹è¯•æ•°æ®</h2>
        <button onclick="addTestData()">æ·»åŠ 3ä¸ªæµ‹è¯•å¾…åŠäº‹é¡¹</button>
        <div id="addDataResult" class="result"></div>
      </div>

      <div class="section">
        <h2>6. è·å–å¾…åŠåˆé›†</h2>
        <button onclick="getCollections()">è·å–å¾…åŠåˆé›†åˆ—è¡¨</button>
        <div id="collectionsResult" class="result"></div>
      </div>

      <div class="section">
        <h2>7. æ‰‹åŠ¨æ·»åŠ å¾…åŠåˆé›†ï¼ˆè°ƒè¯•ç”¨ï¼‰</h2>
        <div class="form-group">
          <label>åˆé›†æ ‡é¢˜:</label>
          <input type="text" id="collectionTitle" value="å­¦ä¹ è®¡åˆ’" />
        </div>
        <div class="form-group">
          <label>åˆé›†æè¿°:</label>
          <input type="text" id="collectionDescription" value="ç³»ç»Ÿæ€§å­¦ä¹ HarmonyOSå¼€å‘" />
        </div>
        <button onclick="addSingleCollection()">æ·»åŠ å•ä¸ªå¾…åŠåˆé›†</button>
        <div id="singleCollectionResult" class="result"></div>
      </div>

      <div class="section">
        <h2>8. æ·»åŠ æµ‹è¯•åˆé›†æ•°æ®</h2>
        <button onclick="addTestCollections()">ä¸€é”®æ·»åŠ 3ä¸ªæµ‹è¯•åˆé›†ï¼ˆå«å­ä»»åŠ¡ï¼‰</button>
        <div id="addCollectionsResult" class="result"></div>
      </div>

      <div class="section">
        <h2>9. æ•°æ®åº“çŠ¶æ€æ£€æŸ¥</h2>
        <p>åœ¨è®¿é—®H2æ§åˆ¶å°ä¹‹å‰ï¼Œå…ˆæ£€æŸ¥æ•°æ®åº“è¿æ¥å’Œæ•°æ®ï¼š</p>
        <button onclick="checkDatabaseStatus()">æ£€æŸ¥æ•°æ®åº“çŠ¶æ€</button>
        <div id="dbStatusResult" class="result"></div>
      </div>

      <div class="section">
        <h2>10. H2æ•°æ®åº“æ§åˆ¶å°</h2>
        <p>ç›´æ¥æŸ¥çœ‹æ•°æ®åº“æ•°æ®ï¼š</p>
        <a href="http://localhost:8080/api/h2-console" target="_blank">æ‰“å¼€H2æ•°æ®åº“æ§åˆ¶å°</a>

        <div style="background: #e7f3ff; padding: 15px; border-radius: 5px; margin: 15px 0">
          <h4>ğŸ“‹ è¿æ¥ä¿¡æ¯ï¼ˆå¤åˆ¶ç²˜è´´å³å¯ï¼‰ï¼š</h4>
          <ul style="font-family: monospace; font-size: 14px">
            <li>
              <strong>JDBC URL:</strong>
              <code>jdbc:h2:file:E:/harmonsProject/MyTestProject/serverDemo/data/dailydb</code>
            </li>
            <li><strong>ç”¨æˆ·å:</strong> sa</li>
            <li><strong>å¯†ç :</strong> (ä¿æŒç©ºç™½)</li>
            <li><strong>Driver Class:</strong> org.h2.Driver</li>
          </ul>
        </div>

        <h4>ğŸ” è¿æ¥æˆåŠŸåæ‰§è¡Œçš„SQLæŸ¥è¯¢ï¼š</h4>
        <div
          style="
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            border-left: 4px solid #007aff;
          ">
          -- æŸ¥çœ‹æ‰€æœ‰è¡¨ SHOW TABLES; -- æŸ¥çœ‹ç”¨æˆ· SELECT * FROM users; -- æŸ¥çœ‹å¤§ç™½å…”ç”¨æˆ·çš„å¾…åŠäº‹é¡¹ SELECT * FROM
          todo_items WHERE user_id = (SELECT id FROM users WHERE username = 'å¤§ç™½å…”'); -- æŸ¥çœ‹å¤§ç™½å…”çš„å¾…åŠåˆé›† SELECT *
          FROM todo_collections WHERE user_id = (SELECT id FROM users WHERE username = 'å¤§ç™½å…”'); --
          æŸ¥çœ‹å¾…åŠåˆé›†çš„å­ä»»åŠ¡ SELECT tc.title as collection_title, tci.title as item_title, tci.description,
          tci.duration_minutes, tci.completed FROM todo_collections tc LEFT JOIN todo_collection_items tci ON tc.id =
          tci.collection_id WHERE tc.user_id = (SELECT id FROM users WHERE username = 'å¤§ç™½å…”') ORDER BY tc.title,
          tci.order_index; -- ç»Ÿè®¡æ¯ä¸ªåˆé›†çš„å­ä»»åŠ¡æ•°é‡ SELECT tc.title as collection_title, COUNT(tci.id) as item_count,
          SUM(CASE WHEN tci.completed = true THEN 1 ELSE 0 END) as completed_count FROM todo_collections tc LEFT JOIN
          todo_collection_items tci ON tc.id = tci.collection_id WHERE tc.user_id = (SELECT id FROM users WHERE username
          = 'å¤§ç™½å…”') GROUP BY tc.id, tc.title;
        </div>

        <p><strong>ğŸ’¡ æç¤ºï¼š</strong> å¦‚æœH2æ§åˆ¶å°è¿æ¥å¤±è´¥ï¼Œè¯´æ˜åç«¯æœåŠ¡å™¨æœªå¯åŠ¨ï¼Œè¯·å…ˆå¯åŠ¨æœåŠ¡å™¨ã€‚</p>
      </div>
    </div>

    <script>
      let authToken = "";

      async function testConnection() {
        const resultDiv = document.getElementById("connectionResult");
        resultDiv.className = "result";
        resultDiv.textContent = "æ­£åœ¨æµ‹è¯•è¿æ¥...";

        try {
          const response = await fetch("http://localhost:8080/api/auth/login", {
            method: "HEAD",
          });
          if (response.ok || response.status === 405) {
            resultDiv.className = "result success";
            resultDiv.textContent = "âœ… æœåŠ¡å™¨è¿æ¥æ­£å¸¸\nâœ… åç«¯APIæœåŠ¡è¿è¡Œä¸­\nâœ… å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ";
          } else {
            resultDiv.className = "result error";
            resultDiv.textContent = `âŒ æœåŠ¡å™¨è¿”å›é”™è¯¯: ${response.status}\nè¯·æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸å¯åŠ¨`;
          }
        } catch (error) {
          resultDiv.className = "result error";
          let errorMsg = `âŒ è¿æ¥å¤±è´¥: ${error.message}\n\n`;

          if (error.message.includes("Failed to fetch")) {
            errorMsg += "ğŸ”§ å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ:\n";
            errorMsg +=
              "1. åç«¯æœåŠ¡å™¨æœªå¯åŠ¨ - è¯·è¿è¡Œ: java -jar serverDemo/target/harmony-daily-app-0.0.1-SNAPSHOT.jar\n";
            errorMsg += "2. ç«¯å£8080è¢«å ç”¨ - è¯·æ£€æŸ¥å…¶ä»–ç¨‹åºæ˜¯å¦å ç”¨æ­¤ç«¯å£\n";
            errorMsg += "3. é˜²ç«å¢™é˜»æ­¢è¿æ¥ - è¯·æ£€æŸ¥é˜²ç«å¢™è®¾ç½®\n";
            errorMsg += "4. ç½‘ç»œé—®é¢˜ - è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥";
          }

          resultDiv.textContent = errorMsg;
        }
      }

      async function login() {
        const resultDiv = document.getElementById("loginResult");
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        try {
          const response = await fetch("http://localhost:8080/api/auth/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ username, password }),
          });

          if (response.ok) {
            const data = await response.json();
            authToken = data.token;
            resultDiv.className = "result success";
            resultDiv.textContent = `âœ… ç™»å½•æˆåŠŸ!\nToken: ${data.token.substring(0, 50)}...\nç”¨æˆ·å: ${data.username}`;
          } else {
            const errorText = await response.text();
            resultDiv.className = "result error";
            resultDiv.textContent = `âŒ ç™»å½•å¤±è´¥: ${response.status}\n${errorText}`;
          }
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.textContent = `âŒ ç™»å½•é”™è¯¯: ${error.message}`;
        }
      }

      async function getTodos() {
        const resultDiv = document.getElementById("todosResult");

        if (!authToken) {
          resultDiv.className = "result error";
          resultDiv.textContent = "âŒ è¯·å…ˆç™»å½•";
          return;
        }

        try {
          const response = await fetch("http://localhost:8080/api/todos", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${authToken}`,
              "Content-Type": "application/json",
            },
          });

          if (response.ok) {
            const todos = await response.json();
            resultDiv.className = "result success";
            resultDiv.textContent = `âœ… è·å–æˆåŠŸï¼å…±${todos.length}ä¸ªå¾…åŠäº‹é¡¹:\n\n${JSON.stringify(todos, null, 2)}`;
          } else {
            const errorText = await response.text();
            resultDiv.className = "result error";
            resultDiv.textContent = `âŒ è·å–å¤±è´¥: ${response.status}\n${errorText}`;
          }
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.textContent = `âŒ è¯·æ±‚é”™è¯¯: ${error.message}`;
        }
      }

      async function addSingleTodo() {
        const resultDiv = document.getElementById("singleTodoResult");
        const title = document.getElementById("todoTitle").value;
        const description = document.getElementById("todoDescription").value;
        const type = document.getElementById("todoType").value;
        const duration = parseInt(document.getElementById("todoDuration").value);

        if (!authToken) {
          resultDiv.className = "result error";
          resultDiv.textContent = "âŒ è¯·å…ˆç™»å½•";
          return;
        }

        const todo = {
          title,
          description,
          type,
          duration,
          isImportant: false,
          isUrgent: false,
        };

        resultDiv.className = "result";
        resultDiv.textContent = "æ­£åœ¨æ·»åŠ å•ä¸ªå¾…åŠäº‹é¡¹...";

        try {
          const response = await fetch("http://localhost:8080/api/todos", {
            method: "POST",
            headers: {
              Authorization: `Bearer ${authToken}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify(todo),
          });

          if (response.ok) {
            const data = await response.json();
            resultDiv.className = "result success";
            resultDiv.textContent = `âœ… å·²æ·»åŠ : ${data.title} (ID: ${data.id})`;
          } else {
            const errorText = await response.text();
            resultDiv.className = "result error";
            resultDiv.textContent = `âŒ æ·»åŠ å¤±è´¥: ${title} - ${errorText}`;
          }
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.textContent = `âŒ æ·»åŠ é”™è¯¯: ${error.message}`;
        }
      }

      async function addTestData() {
        const resultDiv = document.getElementById("addDataResult");

        if (!authToken) {
          resultDiv.className = "result error";
          resultDiv.textContent = "âŒ è¯·å…ˆç™»å½•";
          return;
        }

        const testTodos = [
          {
            title: "å­¦ä¹ HarmonyOSå¼€å‘",
            description: "å®Œæˆç¬¬ä¸€ä¸ªåº”ç”¨å¼€å‘",
            type: "å­¦ä¹ ",
            duration: 120,
            isImportant: true,
            isUrgent: false,
          },
          {
            title: "å†™æŠ€æœ¯åšå®¢",
            description: "åˆ†äº«å¼€å‘ç»éªŒ",
            type: "å·¥ä½œ",
            duration: 60,
            isImportant: false,
            isUrgent: false,
          },
          {
            title: "é”»ç‚¼èº«ä½“",
            description: "æ¯å¤©è·‘æ­¥30åˆ†é’Ÿ",
            type: "å¥åº·",
            duration: 30,
            isImportant: true,
            isUrgent: true,
          },
        ];

        resultDiv.className = "result";
        resultDiv.textContent = "æ­£åœ¨æ·»åŠ æµ‹è¯•æ•°æ®...";

        try {
          const results = [];
          for (const todo of testTodos) {
            try {
              resultDiv.textContent = `æ­£åœ¨æ·»åŠ : ${todo.title}...`;

              console.log("å‘é€æ•°æ®:", JSON.stringify(todo, null, 2));

              const response = await fetch("http://localhost:8080/api/todos", {
                method: "POST",
                headers: {
                  Authorization: `Bearer ${authToken}`,
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(todo),
              });

              if (response.ok) {
                const data = await response.json();
                results.push(`âœ… å·²æ·»åŠ : ${data.title} (ID: ${data.id})`);
              } else {
                // è·å–è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                let errorText;
                try {
                  const errorData = await response.json();
                  errorText = errorData.message || errorData.error || response.statusText;
                } catch {
                  errorText = (await response.text()) || response.statusText;
                }
                results.push(`âŒ æ·»åŠ å¤±è´¥: ${todo.title} - ${response.status} ${errorText}`);
                console.error("è¯¦ç»†é”™è¯¯:", {
                  status: response.status,
                  statusText: response.statusText,
                  error: errorText,
                  todo: todo,
                });
              }
            } catch (error) {
              results.push(`âŒ ç½‘ç»œé”™è¯¯: ${todo.title} - ${error.message}`);
              console.error("ç½‘ç»œé”™è¯¯:", error);
            }
          }

          resultDiv.className = results.some((r) => r.includes("âŒ")) ? "result error" : "result success";
          resultDiv.textContent = results.join("\n");
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.textContent = `âŒ æ·»åŠ é”™è¯¯: ${error.message}`;
        }
      }

      async function getCollections() {
        const resultDiv = document.getElementById("collectionsResult");

        if (!authToken) {
          resultDiv.className = "result error";
          resultDiv.textContent = "âŒ è¯·å…ˆç™»å½•";
          return;
        }

        try {
          const response = await fetch("http://localhost:8080/api/todo-collections", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${authToken}`,
              "Content-Type": "application/json",
            },
          });

          if (response.ok) {
            const collections = await response.json();

            if (collections.length === 0) {
              resultDiv.className = "result success";
              resultDiv.textContent = "âœ… è·å–æˆåŠŸï¼æš‚æ— å¾…åŠåˆé›†";
              return;
            }

            // è·å–æ¯ä¸ªåˆé›†çš„è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬å­ä»»åŠ¡ï¼‰
            let detailText = `âœ… è·å–æˆåŠŸï¼å…±${collections.length}ä¸ªå¾…åŠåˆé›†:\n\n`;

            for (const collection of collections) {
              try {
                // è·å–åˆé›†çš„å­ä»»åŠ¡
                const itemsResponse = await fetch(`http://localhost:8080/api/todo-collections/${collection.id}/items`, {
                  method: "GET",
                  headers: {
                    Authorization: `Bearer ${authToken}`,
                    "Content-Type": "application/json",
                  },
                });

                detailText += `ğŸ“š ${collection.title} (ID: ${collection.id})\n`;
                detailText += `   æè¿°: ${collection.description || "æ— æè¿°"}\n`;

                if (itemsResponse.ok) {
                  const items = await itemsResponse.json();
                  if (items.length > 0) {
                    detailText += `   å­ä»»åŠ¡(${items.length}ä¸ª):\n`;
                    items.forEach((item, index) => {
                      const status = item.completed ? "âœ…" : "â­•";
                      detailText += `   ${index + 1}. ${status} ${item.title} (${item.durationMinutes}åˆ†é’Ÿ)\n`;
                      if (item.description) {
                        detailText += `      â””â”€ ${item.description}\n`;
                      }
                    });
                  } else {
                    detailText += `   å­ä»»åŠ¡: æš‚æ— \n`;
                  }
                } else {
                  detailText += `   å­ä»»åŠ¡: è·å–å¤±è´¥\n`;
                }
                detailText += `\n`;
              } catch (error) {
                detailText += `   å­ä»»åŠ¡: è·å–å‡ºé”™ - ${error.message}\n\n`;
              }
            }

            resultDiv.className = "result success";
            resultDiv.textContent = detailText;
          } else {
            const errorText = await response.text();
            resultDiv.className = "result error";
            resultDiv.textContent = `âŒ è·å–å¤±è´¥: ${response.status}\n${errorText}`;
          }
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.textContent = `âŒ è¯·æ±‚é”™è¯¯: ${error.message}`;
        }
      }

      async function addSingleCollection() {
        const resultDiv = document.getElementById("singleCollectionResult");
        const title = document.getElementById("collectionTitle").value;
        const description = document.getElementById("collectionDescription").value;

        if (!authToken) {
          resultDiv.className = "result error";
          resultDiv.textContent = "âŒ è¯·å…ˆç™»å½•";
          return;
        }

        const collection = {
          title,
          description,
        };

        resultDiv.className = "result";
        resultDiv.textContent = "æ­£åœ¨æ·»åŠ å•ä¸ªå¾…åŠåˆé›†...";

        try {
          const response = await fetch("http://localhost:8080/api/todo-collections", {
            method: "POST",
            headers: {
              Authorization: `Bearer ${authToken}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify(collection),
          });

          if (response.ok) {
            const data = await response.json();
            resultDiv.className = "result success";
            resultDiv.textContent = `âœ… å·²æ·»åŠ : ${data.title} (ID: ${data.id})`;
          } else {
            const errorText = await response.text();
            resultDiv.className = "result error";
            resultDiv.textContent = `âŒ æ·»åŠ å¤±è´¥: ${title} - ${errorText}`;
          }
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.textContent = `âŒ æ·»åŠ é”™è¯¯: ${error.message}`;
        }
      }

      async function addTestCollections() {
        const resultDiv = document.getElementById("addCollectionsResult");

        if (!authToken) {
          resultDiv.className = "result error";
          resultDiv.textContent = "âŒ è¯·å…ˆç™»å½•";
          return;
        }

        // å®šä¹‰æµ‹è¯•åˆé›†åŠå…¶å­ä»»åŠ¡
        const testCollectionsData = [
          {
            collection: {
              title: "HarmonyOSå­¦ä¹ è®¡åˆ’",
              description: "ç³»ç»Ÿæ€§å­¦ä¹ HarmonyOSå¼€å‘æŠ€æœ¯æ ˆ",
            },
            items: [
              { title: "ç¯å¢ƒæ­å»º", description: "å®‰è£…DevEco Studioå’Œé…ç½®å¼€å‘ç¯å¢ƒ", durationMinutes: 30, orderIndex: 1 },
              { title: "ArkTSåŸºç¡€è¯­æ³•", description: "å­¦ä¹ TypeScriptå’ŒArkTSè¯­æ³•", durationMinutes: 60, orderIndex: 2 },
              { title: "ç»„ä»¶åŒ–å¼€å‘", description: "æŒæ¡è‡ªå®šä¹‰ç»„ä»¶å¼€å‘", durationMinutes: 90, orderIndex: 3 },
              { title: "çŠ¶æ€ç®¡ç†", description: "å­¦ä¹ @Stateã€@Propç­‰çŠ¶æ€ç®¡ç†", durationMinutes: 45, orderIndex: 4 },
              { title: "ç½‘ç»œè¯·æ±‚", description: "HTTPæ¨¡å—å’Œæ•°æ®è·å–", durationMinutes: 60, orderIndex: 5 },
            ],
          },
          {
            collection: {
              title: "é¡¹ç›®å¼€å‘è®¡åˆ’",
              description: "å®Œæˆå¾…åŠäº‹é¡¹åº”ç”¨çš„å®Œæ•´å¼€å‘",
            },
            items: [
              { title: "éœ€æ±‚åˆ†æ", description: "æ¢³ç†åº”ç”¨åŠŸèƒ½éœ€æ±‚", durationMinutes: 30, orderIndex: 1 },
              { title: "UIè®¾è®¡", description: "è®¾è®¡ç”¨æˆ·ç•Œé¢å’Œäº¤äº’æµç¨‹", durationMinutes: 45, orderIndex: 2 },
              { title: "å‰ç«¯å¼€å‘", description: "å®ç°HarmonyOSå‰ç«¯é¡µé¢", durationMinutes: 180, orderIndex: 3 },
              { title: "åç«¯å¯¹æ¥", description: "é›†æˆSpring Bootåç«¯API", durationMinutes: 60, orderIndex: 4 },
              { title: "æµ‹è¯•è°ƒè¯•", description: "åŠŸèƒ½æµ‹è¯•å’Œbugä¿®å¤", durationMinutes: 90, orderIndex: 5 },
            ],
          },
          {
            collection: {
              title: "å¥åº·ä½œæ¯è®¡åˆ’",
              description: "ä¿æŒå¥åº·çš„å·¥ä½œå’Œç”Ÿæ´»èŠ‚å¥",
            },
            items: [
              { title: "æ™¨ç»ƒ", description: "æ¯å¤©æ—©ä¸Š30åˆ†é’Ÿè¿åŠ¨", durationMinutes: 30, orderIndex: 1 },
              { title: "ä¸“æ³¨å·¥ä½œ", description: "ä½¿ç”¨ç•ªèŒ„å·¥ä½œæ³•é›†ä¸­æ³¨æ„åŠ›", durationMinutes: 120, orderIndex: 2 },
              { title: "åˆä¼‘", description: "çŸ­æ—¶é—´ä¼‘æ¯æ¢å¤ç²¾åŠ›", durationMinutes: 20, orderIndex: 3 },
              { title: "æ™šé—´å­¦ä¹ ", description: "æŠ€æœ¯å­¦ä¹ å’Œæ€»ç»“", durationMinutes: 60, orderIndex: 4 },
              { title: "ç¡å‰æ”¾æ¾", description: "é˜…è¯»æˆ–å†¥æƒ³", durationMinutes: 30, orderIndex: 5 },
            ],
          },
        ];

        resultDiv.className = "result";
        resultDiv.textContent = "æ­£åœ¨æ·»åŠ æµ‹è¯•åˆé›†æ•°æ®...";

        try {
          const results = [];

          for (const collectionData of testCollectionsData) {
            try {
              // 1. åˆ›å»ºåˆé›†
              resultDiv.textContent = `æ­£åœ¨æ·»åŠ åˆé›†: ${collectionData.collection.title}...`;

              console.log("å‘é€åˆé›†æ•°æ®:", JSON.stringify(collectionData.collection, null, 2));

              const collectionResponse = await fetch("http://localhost:8080/api/todo-collections", {
                method: "POST",
                headers: {
                  Authorization: `Bearer ${authToken}`,
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(collectionData.collection),
              });

              if (collectionResponse.ok) {
                const collection = await collectionResponse.json();
                results.push(`âœ… å·²æ·»åŠ åˆé›†: ${collection.title} (ID: ${collection.id})`);

                // 2. ä¸ºåˆé›†æ·»åŠ å­ä»»åŠ¡
                let itemCount = 0;
                for (const item of collectionData.items) {
                  try {
                    resultDiv.textContent = `æ­£åœ¨ä¸º"${collection.title}"æ·»åŠ å­ä»»åŠ¡: ${item.title}...`;

                    const itemResponse = await fetch(
                      `http://localhost:8080/api/todo-collections/${collection.id}/items`,
                      {
                        method: "POST",
                        headers: {
                          Authorization: `Bearer ${authToken}`,
                          "Content-Type": "application/json",
                        },
                        body: JSON.stringify(item),
                      }
                    );

                    if (itemResponse.ok) {
                      const itemData = await itemResponse.json();
                      itemCount++;
                      console.log(`å­ä»»åŠ¡æ·»åŠ æˆåŠŸ: ${itemData.title}`);
                    } else {
                      const errorText = await itemResponse.text();
                      results.push(`âš ï¸ å­ä»»åŠ¡æ·»åŠ å¤±è´¥: ${item.title} - ${errorText}`);
                    }
                  } catch (error) {
                    results.push(`âš ï¸ å­ä»»åŠ¡ç½‘ç»œé”™è¯¯: ${item.title} - ${error.message}`);
                  }
                }

                results.push(`  â””â”€ æˆåŠŸæ·»åŠ  ${itemCount}/${collectionData.items.length} ä¸ªå­ä»»åŠ¡`);
              } else {
                // è·å–è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                let errorText;
                try {
                  const errorData = await collectionResponse.json();
                  errorText = errorData.message || errorData.error || collectionResponse.statusText;
                } catch {
                  errorText = (await collectionResponse.text()) || collectionResponse.statusText;
                }
                results.push(
                  `âŒ åˆé›†æ·»åŠ å¤±è´¥: ${collectionData.collection.title} - ${collectionResponse.status} ${errorText}`
                );
                console.error("è¯¦ç»†é”™è¯¯:", {
                  status: collectionResponse.status,
                  statusText: collectionResponse.statusText,
                  error: errorText,
                  collection: collectionData.collection,
                });
              }
            } catch (error) {
              results.push(`âŒ ç½‘ç»œé”™è¯¯: ${collectionData.collection.title} - ${error.message}`);
              console.error("ç½‘ç»œé”™è¯¯:", error);
            }
          }

          resultDiv.className = results.some((r) => r.includes("âŒ")) ? "result error" : "result success";
          resultDiv.textContent = results.join("\n");

          // å®Œæˆåè‡ªåŠ¨åˆ·æ–°åˆé›†åˆ—è¡¨
          setTimeout(() => {
            getCollections();
          }, 1000);
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.textContent = `âŒ æ·»åŠ é”™è¯¯: ${error.message}`;
        }
      }

      async function checkDatabaseStatus() {
        const resultDiv = document.getElementById("dbStatusResult");
        resultDiv.className = "result";
        resultDiv.textContent = "æ­£åœ¨æ£€æŸ¥æ•°æ®åº“çŠ¶æ€...";

        if (!authToken) {
          resultDiv.className = "result error";
          resultDiv.textContent = "âŒ è¯·å…ˆç™»å½•è·å–token";
          return;
        }

        try {
          // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
          resultDiv.textContent = "1. æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€...";

          // æ£€æŸ¥å¾…åŠäº‹é¡¹
          const todosResponse = await fetch("http://localhost:8080/api/todos", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${authToken}`,
              "Content-Type": "application/json",
            },
          });

          // æ£€æŸ¥å¾…åŠåˆé›†
          const collectionsResponse = await fetch("http://localhost:8080/api/todo-collections", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${authToken}`,
              "Content-Type": "application/json",
            },
          });

          let statusReport = "";

          if (todosResponse.ok) {
            const todos = await todosResponse.json();
            statusReport += `âœ… å¾…åŠäº‹é¡¹è¿æ¥æ­£å¸¸ - å…±${todos.length}æ¡è®°å½•\n`;
            if (todos.length > 0) {
              statusReport += `æœ€æ–°å¾…åŠ: "${todos[0].title}"\n`;
            }
          } else {
            statusReport += `âŒ å¾…åŠäº‹é¡¹æŸ¥è¯¢å¤±è´¥: ${todosResponse.status}\n`;
          }

          if (collectionsResponse.ok) {
            const collections = await collectionsResponse.json();
            statusReport += `âœ… å¾…åŠåˆé›†è¿æ¥æ­£å¸¸ - å…±${collections.length}æ¡è®°å½•\n`;
          } else {
            statusReport += `âŒ å¾…åŠåˆé›†æŸ¥è¯¢å¤±è´¥: ${collectionsResponse.status}\n`;
          }

          statusReport += "\nğŸ“Š æ•°æ®åº“çŠ¶æ€æ€»ç»“:\n";
          statusReport += `- æ•°æ®åº“æ–‡ä»¶: E:/harmonsProject/MyTestProject/serverDemo/data/dailydb.mv.db\n`;
          statusReport += `- æœåŠ¡å™¨çŠ¶æ€: æ­£å¸¸è¿è¡Œ\n`;
          statusReport += `- ç”¨æˆ·è®¤è¯: å·²é€šè¿‡\n`;

          resultDiv.className = "result success";
          resultDiv.textContent = statusReport;
        } catch (error) {
          resultDiv.className = "result error";
          resultDiv.textContent = `âŒ æ•°æ®åº“çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${error.message}`;
        }
      }
    </script>
  </body>
</html>
